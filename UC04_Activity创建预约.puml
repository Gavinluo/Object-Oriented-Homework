@startuml
title UC04 创建预约 活动图

|用户|
start
:选择房间、日期、时间段;
:填写预约用途;
:点击“提交预约”;

|预约管理子系统|
:检查用户是否已登录;
if (已登录?) then (是)
  ' 继续
else (否)
  :提示“请先登录系统”;
  stop
endif

:检查用户是否在黑名单中;
if (在黑名单?) then (是)
  :提示“由于多次违约，您暂时无法预约”;
  :记录拒绝原因;
  stop
else (否)
  ' 继续
endif

:依据预约规则统计\n用户当日/当周预约次数和总时长;
if (超出预约规则限制?) then (是)
  :提示“已达到当前预约上限”;
  :记录失败日志;
  stop
else (否)
  ' 继续
endif

:检查目标时间段是否被占用;
if (时间段仍可用?) then (是)
  :创建预约记录\n(状态=已预约);
  :更新时间段占用状态;
else (否)
  :提示“该时间段已被其他用户预约”;
  :记录并发冲突日志;
  stop
endif

|通知服务|
:发送预约成功通知\n(短信/邮件/系统消息);
if (通知发送成功?) then (是)
  :记录通知成功日志;
else (否)
  :记录通知失败日志;
  :将通知加入重试队列;
endif

|用户|
:显示“预约成功”页面\n展示预约详情;
stop

@enduml
