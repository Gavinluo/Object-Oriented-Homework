@startuml
title UC07 签到/签退 活动图

|用户|
start
:打开“我的预约”列表;
:选择一条即将开始或进行中的预约;
:点击“签到”;

|预约管理子系统|
:检查预约记录是否属于当前用户\n且状态是否为“已预约”;
if (记录合法?) then (是)
  ' 继续
else (否)
  :提示“预约记录无效或不属于当前用户”;
  :记录安全日志;
  stop
endif

:检查当前时间是否在允许签到窗口内\n(如开始前15分钟~开始后15分钟);
if (在签到时间窗口内?) then (是)
  :更新预约状态为“已签到”;
else (否)
  :记录异常签到事件\n(迟到或超时);
endif

|用户|
:开始使用自习室/讨论室;

' ===== 签退流程 =====
:使用结束后点击“签退”;

|预约管理子系统|
:检查预约是否已签到或处于进行中;
if (允许签退?) then (是)
  :记录实际结束时间;
  :更新预约状态为“已完成”;
else (否)
  :记录异常签退事件;
endif

' ===== 违约判断 =====
:依据签到/签退记录\n判断是否构成违约;
if (是否构成违约?) then (是)
  |违约与黑名单管理模块|
  :增加用户违约次数;
  if (违约次数超过阈值?) then (是)
    :将用户加入黑名单\n或延长黑名单有效期;
  else (否)
    :仅记录违约并生成提醒;
  endif
else (否)
  ' 无违约，正常结束
endif

|用户|
:在“我的预约”中查看\n本次预约状态与违约情况;
stop

@enduml
